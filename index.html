<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="GuidaTV - La tua guida completa ai programmi TV italiani con streaming online. Scopri cosa c'è in onda ora e stasera.">
    <meta name="keywords" content="guida tv, programmi tv, streaming tv italia, palinsesto tv, tv online, canali tv italiani">
    <meta name="author" content="emax83dev">
    <meta name="theme-color" content="#0a0e27">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="GuidaTV - Guida TV Completa">
    <meta property="og:description" content="La tua guida completa ai programmi TV italiani con streaming online">
    <meta property="og:image" content="/img/og-image.jpg">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="GuidaTV - Guida TV Completa">
    <meta name="twitter:description" content="La tua guida completa ai programmi TV italiani con streaming online">
    <meta name="twitter:image" content="/img/twitter-image.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    
    <title>GuidaTV - Guida TV Completa</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css">

    <!-- VueJS 3-->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.5.24/dist/vue.global.min.js"></script>
    
    <!-- Miei files -->
    <link rel="stylesheet" href="/css/style.css">
    

</head>
<body>
    <div id="app" v-cloak>
    <!-- Toolbar -->
    <nav class="navbar navbar-expand toolbar fixed-top">
        <div class="container-fluid">
            <span class="navbar-brand logo-text mb-0 h1">
                <img src="img/favicon-transparent.png" alt="Guida TV" title="Guida TV" style="width: 48px;" />
                <span class="d-none d-md-inline">Guida TV</span>
            </span>
            <div class="d-flex align-items-center gap-2 flex-wrap">
                <button class="btn btn-nav" @click="currentSection = 'favorites'" title="Preferiti">
                    <i class="bi bi-star"></i>
                    <span class="d-none d-sm-inline ms-1">Preferiti</span>
                </button>
                <button class="btn btn-nav" @click="currentSection = 'now'" title="Ora in Onda">
                    <i class="bi bi-broadcast"></i>
                    <span class="d-none d-sm-inline ms-1">Ora</span>
                </button>
                <button class="btn btn-nav" @click="currentSection = 'evening'" title="Stasera">
                    <i class="bi bi-moon-stars"></i>
                    <span class="d-none d-sm-inline ms-1">Stasera</span>
                </button>
                <button class="btn btn-nav" @click="currentSection = 'movies'" title="Film">
                    <i class="bi bi-film"></i>
                    <span class="d-none d-sm-inline ms-1">Films</span>
                </button>
                <button class="btn btn-nav" @click="currentSection = 'channels'" title="Canali">
                    <i class="bi bi-grid-3x3"></i>
                    <span class="d-none d-sm-inline ms-1">Canali</span>
                </button>
                <button class="btn btn-nav" @click="currentSection = 'search'" title="Cerca">
                    <i class="bi bi-search"></i>
                </button>
                <span class="current-time ms-2" id="currentTime"></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid px-3 py-4">
        
        <!-- Loading -->
        <div id="loading" class="text-center py-5" v-if="loading == true">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Caricamento...</span>
            </div>
            <p class="mt-3">Caricamento...</p>
        </div>

        <!-- Preferiti Section -->
        <div id="favoritesSection" class="section" v-show="currentSection == 'favorites'">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-star-fill"></i> I Miei Preferiti</h2>
            </div>
            
            <div id="favoritesEmpty" class="text-center py-5" v-if="!hasFavorites">
                <i class="bi bi-star" style="font-size: 4rem; color: var(--text-secondary);"></i>
                <p class="text-light mt-3">Nessun preferito salvato</p>
                <p class="text-light">Aggiungi canali o programmi ai preferiti per vederli qui!</p>
            </div>
            
            <div id="favoriteChannelsContainer" class="mb-3" v-if="hasFavorites">
                <h4 class="mb-3"><i class="bi bi-tv"></i> Canali</h4>
                <div id="favoriteChannels" class="channel-scroll p-3">
                    <div class="favorite-card" v-for="fav in favoriteChannels" @click="handleFavoriteChannelClick(fav)">
                        <img :src="fav.logo" :alt="fav.name" class="channel-logo" @error="handleImageError">
                        <div class="channel-name">{{fav.name}}</div>
                    </div>
                </div>
            </div>
            
            <div id="favoriteProgramsContainer" class="mb-3" v-if="hasFavorites">
                <h4 class="mb-3"><i class="bi bi-collection-play"></i> Programmi</h4>
                <div id="favoritePrograms" class="channel-scroll p-3">
                    <div class="favorite-card favorite-card-program" v-for="fav in favoriteProgramsWithInfo" @click="handleFavoriteProgramClick(fav)">
                        <div class="row mb-2">
                            <div class="col-5">
                                <img :src="fav.channelLogo" :alt="fav.channelName" class="channel-logo" @error="handleImageError">
                                <div class="channel-name">{{fav.channelName}}</div>
                            </div>
                            <div class="col-7">
                                <h5 class="program-title">{{fav.title}}</h5>
                                <span class="program-genre">{{fav.category}}</span>
                                <span class="badge bg-warning" v-if="isFavoriteProgramScheduled(fav)" ><i class="bi bi-check-circle"></i> OGGI</span>
                                <span class="badge bg-danger" v-if="isFavoriteProgramLive(fav)"><i class="bi bi-play-circle-fill"></i> IN ONDA</span>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- Ora in Onda Section -->
        <div id="nowSection" class="section" v-show="currentSection == 'now'">
            <h2 class="mb-4"><i class="bi bi-broadcast"></i> Ora in Onda</h2>
            <div id="nowChannels" class="epg-container">
                <!-- Colonna fissa con i canali -->
                <div class="channels-column">
                    <div class="channel-header">Canali</div>
                    <div class="channel">Rai 1</div>
                    <div class="channel">Rai 2</div>
                    <div class="channel">Rai 3</div>
                    <div class="channel">Rai 4</div>
                </div>

                <!-- Parte scrollabile -->
                <div class="epg-scroll">
                    <!-- RIGA HEADER (slot orari) -->
                    <div class="epg-row epg-header">
                    <div class="time-slot">08:00</div>
                    <div class="time-slot">09:00</div>
                    <div class="time-slot">10:00</div>
                    <div class="time-slot">11:00</div>
                    </div>

                    <!-- RIGHE PROGRAMMI -->
                    <div class="epg-row">
                    <div class="program" style="width: 400px;">TG1 Mattina</div>
                    <div class="program" style="width: 570px;">Unomattina</div>
                    </div>

                    <div class="epg-row">
                    <div class="program" style="width: 200px;">Cartoni</div>
                    <div class="program" style="width: 400px;">Sport</div>
                    <div class="program" style="width: 350px;">Film</div>
                    </div>

                    <div class="epg-row">
                    <div class="program" style="width: 300px;">Documentario</div>
                    <div class="program" style="width: 350px;">Serie TV</div>
                    <div class="program" style="width: 300px;">Talk Show</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stasera Section -->
        <div id="eveningSection" class="section" v-show="currentSection == 'evening'">
            <h2 class="mb-4"><i class="bi bi-moon-stars"></i> Stasera (20:00 - 23:00)</h2>
            <div id="eveningChannels" class="scroll-container">
                <div class="fixed-column">
                    <div class="cell header"><i class="bi bi-moon-stars"></i></div>
                    <div class="cell">20:00</div>
                    <div class="cell">20:30</div>
                    <div class="cell">21:00</div>
                    <div class="cell">21:30</div>
                    <div class="cell">22:00</div>
                    <div class="cell">22:30</div>
                    <div class="cell">23:00</div>
                </div>

                <div class="scrollable-columns">
                    <div class="column">
                        <div class="cell header">RAI 1</div>
                        <div class="cell-program">
                            <div>Programma 1</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                        <div class="cell-program">
                            <div>Programma 1</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                        <div class="cell-program">
                            <div>Programma 1</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                    </div>

                    <div class="column">
                        <div class="cell header">RAI 2</div>
                        <div class="cell-program">
                            <div>Programma 1</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                        <div class="cell">
                            <div>Programma 2</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                        <div class="cell-program">
                            <div>Programma 3</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                    </div>

                    <div class="column">
                        
                    <div class="cell header">RAI 3</div>
                        <div class="cell-program">
                            <div>Programma 1</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                        <div class="cell-program">
                            <div>Programma 1</div>
                            <div>20:00 - 30 min</div>
                            <div>Azione</div>
                        </div>
                        <div class="cell-program">
                            <div>Programma 1</span>
                            <div>20:00 - 30 min</span>
                            <div>Azione</div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Films Section -->
         <div id="moviesSection" class="section" v-show="currentSection == 'movies'">
            <h2 class="mb-4"><i class="bi bi-film"></i> Tutti i Film</h2>
            <div id="moviesGrid" class="movies-grid">
                <div class="movie-card" v-for="movie in allMovies">
                    <div class="text-center mb-3">
                        <div class="d-flex justify-content-center align-items-center gap-2 mt-2">
                            <img :src="movie.channel.logo" :alt="movie.channel.name" :title="movie.channel.name">
                            <h4 class="mx-3">{{movie.channel.name}}</h4>
                            <button class="favorite-btn float-end" title="Aggiungi canale ai preferiti" @click="toggleFavoriteChannel(movie.channel)">
                                <i class="bi bi-star"></i>
                            </button>
                        </div>
                    </div>
                    <div class="program-card">
                        <img :src="movie.program.image" :alt="movie.program.title" class="program-image">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h3 class="program-title">{{movie.program.title}}</h3>
                            <button class="favorite-btn float-end" title="Aggiungi programma ai preferiti" @click="toggleFavoriteProgram(movie.channel, movie.program)">
                                <i class="bi bi-star"></i>
                            </button>
                        </div>
                        <div class="program-time">
                            <span><i class="bi bi-clock"></i> {{formatTime(movie.program.start)}} • {{getDuration(movie.program)}}</span>
                            <span class="program-genre">{{movie.program.category}}</span>
                            <p class="mt-3 program-description">{{movie.program.description}}</p>
                        </div>
                    </div>
                </div>
            </div>
         </div>

        <!-- Lista Canali Section -->
        <div id="channelsSection" class="section" v-show="currentSection == 'channels'">
            <h2 class="mb-4"><i class="bi bi-grid-3x3"></i> Tutti i Canali</h2>
            <div id="channelsGrid" class="channels-grid">
                <div class="channel-grid-item" v-for="channel in channels" @click="showChannelSchedule(channel)">
                    <img :src="channel.logo" :alt="channel.name" :title="channel.name" class="channel-logo" @error="handleImageError(event)">
                    <div class="channel-name">{{channel.name}}</div>
                </div>
            </div>
        </div>

        <!-- Schermata Ricerca -->
         <div id="searchSection" class="section" v-show="currentSection == 'search'">
            <h2 class="mb-4"><i class="bi bi-search"></i> Cerca Canali e Programmi</h2>
            <input type="search" class="form-control search-input mb-4" autofocus id="searchInput" placeholder="Cerca canale o programma..." v-model="searchQuery" >
            <div v-if="searchQuery.length < 3">
                <small>Inserisci almento 3 caratteri</small>
            </div>
            <div v-if="searchQuery.length > 2 & searchResults.length == 0">
                <small>Nessun risultato trovato..</small>
            </div>
            <div id="searchResults" class="search-results-list" v-show="searchResults.length > 0">
                <div v-for="item in searchResults" class="search-result" @click="handleSearchResultClick(item)">
                    <div class="d-flex align-items-center">
                        <img :src="item.image" class="search-result-image" @error="handleImageError(event)">
                        <div class="flex-grow-1">
                            <div class="fw-bold">{{item.title}}</div>
                            <small class="text-light">
                                <span v-if="item.channel" class="me-3"><i class="bi bi-tv"></i> {{item.channel.name}}</span>
                                <span v-if="item.program" class="me-3"><i class="bi bi-clock"></i> {{ formatTime(item.program.start)}}</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
         </div>

    </div>

    <!-- Bottom Sheet Backdrop -->
    <div class="bottom-sheet-backdrop" :class="{'show' : showBottomSheet}" v-if="showBottomSheet" id="bottomSheetBackdrop" @click="showBottomSheet = false"></div>

    <!-- Bottom Sheet -->
    <div class="bottom-sheet" :class="{'show' : showBottomSheet}" id="bottomSheet" v-if="showBottomSheet">
        <div class="bottom-sheet-handle"></div>
        <div class="p-4" id="bottomSheetContent">
            <div class="text-center mb-3">
                <div class="d-flex justify-content-center align-items-center gap-2 mt-2">
                    <img :src="selectedChannel.logo" :alt="selectedChannel.name" :title="selectedChannel.name" @error="handleImageError(event)">
                    <h4 class="mx-3">{{selectedChannel.name}}</h4>
                    <button class="favorite-btn float-end" :class="{'active' : isFavoriteChannel(selectedChannel)}" @click="toggleFavoriteChannel(selectedChannel)" title="Aggiungi canale ai preferiti">
                        <i class="bi bi-star"></i>
                    </button>
                </div>
            </div>
            <div class="program-card" v-if="selectedProgram">
                <img :src="selectedProgram.image" class="program-image" @error="handleImageError(event)">
                <div class="d-flex justify-content-between align-items-start mb-2">
                        <h3 class="program-title">{{selectedProgram.title}}</h3>
                        <button class="favorite-btn float-end" :class="{'active' : isFavoriteProgram(selectedChannel, selectedProgram)}" 
                        @click="toggleFavoriteProgram(selectedChannel, selectedProgram)" title="Aggiungi programma ai preferiti">
                            <i class="bi bi-star"></i>
                        </button>
                </div>
                
                <div class="program-time">
                    <i class="bi bi-clock"></i> {{formatTime(selectedProgram.start)}} • {{getDuration(selectedProgram)}}
                </div>
                <span class="program-genre">{{selectedProgram.category}}</span>
                <span class="badge bg-danger" v-if="isProgramLive(selectedProgram)" >IN ONDA</span>

                <p class="mt-3">{{selectedProgram.description}}</p>
                <div class="mt-3" v-if="isProgramLive(selectedProgram)">
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" :style="{ width: getProgress(selectedProgram) + '%' }"></div>
                    </div>
                    <small class="text-muted">{{getProgress(selectedProgram)}} completato</small>
                    <div class="border-top mt-2">
                        <a class="btn btn-primary mt-3 w-100" :href="selectedChannel.playUrl" target="_blank">
                            <i class="bi bi-play-fill"></i> Guarda Online
                        </a>
                    </div>
                </div>
                <div v-else>
                    <!-- aggiungi a calendario -->
                </div>
                
            </div>
        </div>
    </div>

    <!-- Channel Schedule Modal -->
    <div class="modal fade" :class="{'show' : showScheduleModal}" id="scheduleModal" tabindex="-1" v-if="showScheduleModal == true && selectedChannel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-between">
                    <img :src="selectedChannel.logo" :alt="selectedChannel.name" @error="handleImageError(event)">
                    <h5 class="modal-title me-5" id="scheduleChannelName">{{selectedChannel.name}}</h5>

                    <button class="favorite-btn" :class="{'active' : isFavoriteChannel(selectedChannel)}" @click="toggleFavoriteChannel(selectedChannel)" title="Aggiungi canale ai preferiti">
                        <i class="bi bi-star"></i>
                    </button>

                    <button type="button" class="btn-close btn-close-white text-white" @click="showScheduleModal = false"></button>
                </div>
                <div class="modal-body" id="scheduleContent" >
                    <div class="program-card" :class="{ 'border-primary': isProgramLive(program) }"
                        v-for="program in selectedChannel.programs" :key="program.id"
                        @click="showProgramInModal(selectedChannel, program);showScheduleModal=false;">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <button class="favorite-btn float-end" :class="{'active' : isFavoriteProgram(selectedChannel, program)}" 
                                @click.stop="toggleFavoriteProgram(selectedChannel, program)" title="Aggiungi programma ai preferiti">
                                    <i class="bi bi-star"></i>
                                </button>
                                <h5 class="program-title" >{{program.title}}</h5>
                                <div class="program-time">
                                    <i class="bi bi-clock"></i> {{ formatTime(program.start)}} • {{getDuration(program)}}
                                </div>
                            </div>
                            <span class="badge bg-danger" v-if="isProgramLive(program)" >IN ONDA</span>
                        </div>
                        <span class="program-genre">{{program.category}}</span>
                        <p class="mt-2 mb-0 small">{{program.description}}</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-primary mt-3" :href="selectedChannel.playUrl" target="_blank">
                            <i class="bi bi-play-fill"></i> Guarda Online
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Banner -->
    <div class="cookie-banner" id="cookieBanner" v-if="showCookieBanner==true" >
        <div class="cookie-banner-content">
            <div class="cookie-banner-text">
                <h5><i class="bi bi-shield-check"></i> Privacy & Cookie</h5>
                <p>
                    Questo sito <strong>non utilizza cookie di tracciamento</strong> e <strong>non memorizza informazioni personali</strong>. 
                    Utilizziamo solo la memoria del browser per salvare le tue preferenze come i canali preferiti.
                </p>
            </div>
            <div class="cookie-banner-actions">
                <!-- Versione semplice (attuale) -->
                <button class="btn btn-simple-ok" @click="acceptCookies(false)">
                    <i class="bi bi-check-circle"></i> Ho capito
                </button>
                
                <!-- Versione futura con profiliazione (commentata, pronta all'uso) -->
                <!--
                <button class="btn btn-accept-all" onclick="app.acceptCookies(true)">
                    <i class="bi bi-check-circle"></i> Accetta Tutto
                </button>
                <button class="btn btn-reject-optional" onclick="app.acceptCookies(false)">
                    <i class="bi bi-x-circle"></i> Rifiuta Opzionali
                </button>
                -->
            </div>
        </div>
    </div>
   </div>

   <script src="js/scripts.js"></script>

</body>
</html>
