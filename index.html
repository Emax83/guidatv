<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="GuidaTV - La tua guida completa ai programmi TV italiani con streaming online. Scopri cosa c'è in onda ora e stasera.">
    <meta name="keywords" content="guida tv, programmi tv, streaming tv italia, palinsesto tv, tv online, canali tv italiani">
    <meta name="author" content="emax83dev">
    <meta name="theme-color" content="#0a0e27">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="GuidaTV - Guida TV Completa">
    <meta property="og:description" content="La tua guida completa ai programmi TV italiani con streaming online">
    <meta property="og:image" content="/img/og-image.jpg">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="GuidaTV - Guida TV Completa">
    <meta name="twitter:description" content="La tua guida completa ai programmi TV italiani con streaming online">
    <meta name="twitter:image" content="/img/twitter-image.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    
    <title>GuidaTV - Guida TV Completa</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css">

    <!-- VueJS 3-->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.5.24/dist/vue.global.min.js"></script>
    
    <!-- Miei files -->
    <link rel="stylesheet" href="/css/style.css">
    

</head>
<body>
    <div id="app" v-cloak>
    <!-- Toolbar -->
    <nav class="navbar navbar-expand toolbar fixed-top">
        <div class="container-fluid">
            <span class="navbar-brand logo-text mb-0 h1">
<<<<<<< HEAD
                <button class="btn btn-nav p-0" @click="currentSection = 'homepage'" title="Homepage">
=======
                <button class="btn btn-link p-0" @click="currentSection = 'homepage'" title="Homepage">
>>>>>>> e2d965da05e1be64a5ef3f250a882dd54bdac4f2
                <img src="img/favicon-transparent.png" alt="Guida TV" title="Guida TV" style="width: 48px;" />
                    <span class="d-none d-sm-inline fw-bold">Guida TV</span>
                </button>
            </span>
            <div class="d-flex align-items-center gap-2 flex-nowrap">

                <!--
                <button class="btn btn-nav" :class="{'active' : currentSection == 'favorites'}"  @click="currentSection = 'favorites'" title="Preferiti">
                    <i class="bi bi-star"></i>
                    <span class="d-none d-sm-inline ms-1">Preferiti</span>
                </button>
                
                <button class="btn btn-nav":class="{'active' : currentSection == 'now'}" @click="currentSection = 'now'" title="Ora in Onda">
                    <i class="bi bi-broadcast"></i>
                    <span class="d-none d-sm-inline ms-1">Ora</span>
                </button>
                <button class="btn btn-nav":class="{'active' : currentSection == 'evening'}" @click="currentSection = 'evening'" title="Stasera">
                    <i class="bi bi-moon-stars"></i>
                    <span class="d-none d-sm-inline ms-1">Stasera</span>
                </button>
                -->
                <button class="btn btn-nav":class="{'active' : currentSection == 'epg'}" @click="currentSection = 'epg'" title="Programmazione">
                    <i class="bi bi-calendar2-range"></i>
                    <span class="d-none d-sm-inline ms-1">Programmazione</span>
                </button>
                <button class="btn btn-nav":class="{'active' : currentSection == 'movies'}" @click="currentSection = 'movies'" title="Film">
                    <i class="bi bi-film"></i>
                    <span class="d-none d-sm-inline ms-1">Films</span>
                </button>
                <button class="btn btn-nav":class="{'active' : currentSection == 'channels'}" @click="currentSection = 'channels'" title="Canali">
                    <i class="bi bi-grid-3x3"></i>
                    <span class="d-none d-sm-inline ms-1">Canali</span>
                </button>
                <button class="btn btn-nav":class="{'active' : currentSection == 'search'}" @click="currentSection = 'search'" title="Cerca">
                    <i class="bi bi-search"></i>
                </button>
                <span class="current-time mx-2" id="currentTime">{{currentTime}}</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid px-3 py-5">
        
        <!-- Loading -->
        <div id="loading" class="text-center py-5" v-if="loading == true">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Caricamento...</span>
            </div>
            <p class="mt-3">Caricamento...</p>
        </div>

        <!-- Homepage -->
        <div id="homepage" class="section home-screen" v-if="currentSection == 'homepage'">

            <section class="greetings mb-3">
<<<<<<< HEAD
                <button class="float-end btn btn-dark"><i class="bi bi-eraser-fill" @click="greetingsName='straniero'"></i></button>
                <h2 class="greeting">{{greetingsTime}}, {{greetingsName}} </h2>
=======
                <h3 class="greeting">{{greetingsTime}}, {{greetingsName}}</h3>
>>>>>>> e2d965da05e1be64a5ef3f250a882dd54bdac4f2
                <div v-if="greetingsName == 'straniero' || !greetingsName">
                    <p>Vogliamo conoscerci meglio? Come ti posso chiamare?</p>
                    <div class="input-group">
                        <input type="text" class="form-control bg-dark text-light" v-model="newGreetingsName" placeholder="Inserisci il tuo nome o soprannome" />
                        <button type="button" class="btn btn-primary" @click="greetingsName = newGreetingsName;saveFilters()">
                            <i class="bi bi-save">Salva</i>
                        </button>
                    </div>
                </div>
                <div v-else><button class="btn btn-link" @click="greetingsName = 'straniero'"><i class="bi bi-eraser"></i></button></div> 
            </section>

            <!-- HERO -->
            <section class="hero mb-3">

                <h2 class="section-title"><div class="badge-live text-light" style="position:relative;display: inline-block; top:0; left: 0;height: 2rem;
    width: 2rem; padding: 9px;"> <i class="bi bi-broadcast"></i></div> On Air</h2>

                <div class="tv-carousel-wrapper">
                    <button class="tv-carousel-arrow left" id="tv_prev"  @click="scrollPrev" >&#10094;</button>

                    <div class="tv-carousel" id="tv_carousel" ref="carousel" @mouseenter="pauseAutoScroll" @mouseleave="resumeAutoScroll">
                        
                        <div class="tv-carousel-item" v-for="program in carouselOnAirPrograms" @click="showProgramInModal(program.channel, program)">
                            <div class="tv-carousel-item-channel-logo">
                                <img :src="program.channelLogo" :alt="program.channelName" :title="program.channelName">    
                            </div>
                            <img :src="program.image" :alt="program.title" :title="program.title">
                            <div class="tv-carousel-overlay">
                                <h2>{{program.title}}</h2>
                                <p>{{program.category}}</p>
                            </div>
                        </div>

                    </div>

                    <button class="tv-carousel-arrow right" id="tv_next" @click="scrollNext">&#10095;</button>
                </div>
                
            </section>

            <!-- FAVORITI -->
            <section class="favorites mb-3">
                <h2 class="section-title">I tuoi preferiti</h2>
                <div class="fav-list" v-if="hasFavorites">
                    <div class="fav-card" v-for="channel in favoriteChannels" @click="showChannelSchedule(channel)">
                        <div class="logo"><img :alt="channel.name" :title="channel.name" :src="channel.logo || '/img/placeholder.png'" loading="lazy" /></div>
                        <p>{{channel.name}}</p>
                    </div>

                    <div class="fav-card" v-for="fav in favoriteProgramsWithInfo">
                        <div class="fav-card-channel-logo">
                            <img :alt="fav.channelName" :title="fav.channelName" :src="fav.channelLogo" loading="lazy" />
                        </div>
                        <div class="logo"><img :alt="fav.program.title" :title="fav.program.title" :src="fav.program.image || '/img/placeholder.png'" loading="lazy" /></div>
                        <div class="tv-carousel-overlay">
                            <p>{{fav.program.title}}</p>
                            <p>{{fav.program.category}}</p>
                            <p>{{fav.channelName}}</p>
                        </div>
                        
                    </div>

                </div>
            </section>

            <!-- TAGS -->
            <section class="tags mb-3">
                <h2 class="section-title">Tag</h2>
                <div class="tag-list p-2">
                    <button class="tag" v-for="tag in tagList" @click="searchQuery=tag; currentSection='search'">
                        {{tag}}
                    </button>
                </div>

            </section>

        </div>
        

        <!-- Ora in Onda Section -->
        <div id="nowSection" class="section" v-if="currentSection == 'now'">
            <div class="form-check float-end">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input" v-model="epgOnlyFavorites">
                     Favoriti
                </label>
            </div>
            <h2 class="mb-4"><i class="bi bi-broadcast"></i><span class="mx-1 text-shadow">{{ currentDate }}</span></h2>
            
            <div id="nowChannels" class="epg-container" v-if="isMobile == false">
                <!-- Colonna fissa con i canali -->
                <div class="channels-column">
                    <div class="channel-header">Canali</div>
                    <div class="channel" v-for="channel in epgChannels">
                        <img class="channel-logo" :src="channel.logo" :alt="channel.name" :title="channel.name" />
                    </div>
                </div>

                <!-- Parte scrollabile -->
                <div class="epg-scroll">
                    <!-- RIGA HEADER (slot orari) -->
                    <div class="epg-row">
                        <div class="time-slot epg-header" v-for="slot in timeSlotsAllDay">{{slot}}</div>
                    </div>
                    <!-- RIGHE PROGRAMMI -->
                    <div class="epg-row" v-for="channel in epgChannels">
                        <div class="program" v-for="program in getTodayPrograms(channel)" :style="'width: ' + getProgramWidth(program)" 
                            @click="showProgramInModal(channel, program)" :title="program.title">
                            <div class="program-title">{{program.title}}</div>
                            <div class="program-time">
                                <span>{{formatTime(program.start)}}</span> - <span>{{formatTime(program.stop)}}</span> - <span>{{ getDuration(program)}}</span>
                            </div>
                            <span class="program-genre">{{program.category}}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="nowChannels" class="" v-if="isMobile == true">
                <div class="horizontal-scroll  box-shadow">
                    <div class="epg-column box-shadow" v-for="channel in epgChannels" :key="channel.id">
                        <div class="epg-channel">
                            <img class="logo-image" :src="channel.logo ?? 'invalid-url'" :alt="channel.name" :title="channel.name" @error="handleImageError" />
                        </div>
                        <ul class="epg-program-list list-group list-group-flush">
                            <li class="list-group-item" v-for="program in channel.programs" :key="program.id">
                                <div class="epg-program" @click="showProgramInModal(channel, program)">
                                    <div class="program-time">{{program.startTime}} - {{program.stopTime}}</div>
                                    <div class="program-image"><img class="logo-image" :src="program.image ?? 'invalid-url'" :alt="program.title" :title="program.title" @error="handleImageError" /></div>
                                    <div class="program-title">{{program.title}}</div>
                                    <div class="program-genre">
                                        <span>{{program.category}}</span>
                                        <!--<span class="badge bg-danger" v-if="isProgramLive(program)"><i class="bi bi-play-circle-fill"></i> IN ONDA</span>-->
                                    </div>
                                    <div class="badge-live" v-if="isProgramLive(program)"><i class="bi bi-circle-fill"></i></div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

        <!-- Stasera Section -->
        <div id="eveningSection" class="section" v-if="currentSection == 'evening'">
            <div class="form-check float-end">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input" v-model="epgOnlyFavorites">
                     Favoriti
                </label>
            </div>
            <h2 class="mb-4"><i class="bi bi-moon-stars"></i><span class="ms-3 text-shadow">Stasera</span></h2>

            <div id="eveningChannels" class="scroll-container" v-if="isMobile == false">
                <div class="fixed-column">
                    <div class="cell header"><i class="bi bi-moon-stars"></i></div>
                    <div class="cell epg-header" v-for="slot in timeSlotsEvening">{{slot}}</div>
                </div>

                <div class="scrollable-columns">
                    <div class="column" v-for="channel in epgChannels">
                        <div class="cell header">{{channel.name}}</div>
                        <div class="cell-program" v-for="program in getEveningPrograms(channel)"
                            :style="'height: ' + getProgramHeight(program)"
                            @click="showProgramInModal(channel, program)" :title="program.title">
                            <div class="program-title">{{program.title}}</div>
                            <div class="program-time">{{formatTime(program.start)}} - {{formatTime(program.stop)}} - {{getDuration(program)}}</div>
                            <div class="program-genre">{{program.category}}</div>
                        </div>
                    </div>

                </div>
            </div>
            <div id="eveningChannels" class="" v-if="isMobile == true">
                <div class="horizontal-scroll box-shadow">
                    <div class="epg-column box-shadow" v-for="channel in epgChannels" :key="channel.id">
                        <div class="epg-channel">
                            <img class="logo-image" :src="channel.logo ?? 'invalid-url'" :alt="channel.name" :title="channel.name" @error="handleImageError" />
                            <div class="logo-text">{{channel.name}}</div>
                        </div>
                        <ul class="epg-program-list list-group list-group-flush">
                            <li class="list-group-item" v-for="program in getEveningPrograms(channel)" :key="program.id">
                                <div class="epg-program" @click="showProgramInModal(channel, program)">
                                    <div class="program-time">{{formatTime(program.start)}} - {{formatTime(program.stop)}}</div>
                                    <div class="program-image"><img class="logo-image" :src="program.image ?? 'invalid-url'" :alt="program.title" :title="program.title" @error="handleImageError"/></div>
                                    <div class="program-title">{{program.title}}</div>
                                    <div class="program-genre">
                                        <span>{{program.category}}</span>
                                        <!--<span class="badge bg-danger" v-if="isProgramLive(program)"><i class="bi bi-play-circle-fill"></i> IN ONDA</span>-->
                                    </div>
                                    <div class="badge-live" v-if="isProgramLive(program)"><i class="bi bi-circle-fill"></i></div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>


        <!-- Programmazione SECTION -->
        <div id="epg" class="section" v-if="currentSection == 'epg'">
            <div class="row text-center">
                <div class="col-12 col-md-6">
                    <h2 class="mb-4"><i class="bi bi-calendar2-range"></i><span class="ms-3 text-shadow">{{ currentDate }}</span></h2>
                </div>
                <div class="col-4 col-md-2">
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" v-model="epgOnlyOnAir"/> 
                            <span class="text-shadow"><i class="bi bi-broadcast"></i> Live</span>
                        </label>
                    </div>
                </div>
                <div class="col-4 col-md-2">
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" v-model="epgOnlyEvening"/>
                            <span class="text-shadow"><i class="bi bi-moon-stars"></i> Sera</span>
                        </label>
                    </div>
                </div>
                <div class="col-4 col-md-2">
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" v-model="epgOnlyFavorites">
                            <span class="text-shadow"><i class="bi bi-star"></i> Fav</span>
                        </label>
                    </div>
                </div>
            </div>
            <div id="epgDesktop" class="scroll-container" v-if="isMobile == false">
                <!-- Colonna fissa con i canali -->
                <div class="channels-column">
                    <div class="channel-header">Canali</div>
                    <div class="channel" v-for="channel in getEpgChannels()" @click="showChannelSchedule(channel)">
                        <img class="channel-logo" :src="channel.logo" :alt="channel.name" :title="channel.name" />
                    </div>
                </div>

                <!-- Parte scrollabile -->
                <div class="epg-scroll">

                    <!-- indicatore orario corrente -->
                    <div id="currentTimeline" class="epg-current-time">&nbsp;</div>
                    
                    <!-- RIGA HEADER (slot orari) -->
                    <div class="epg-row">
                        <div class="time-slot epg-header" v-for="slot in getEpgTimeSlots()">{{slot}}</div>
                    </div>
                    <!-- RIGHE PROGRAMMI -->
                    <div class="epg-row" v-for="channel in getEpgChannels()">
                        <div class="program" v-for="program in getEpgPrograms(channel)" :style="'width: ' + getProgramWidth(program)" 
                            :class="{'active' : isProgramLive(program) || isFavoriteProgram(channel, program)}" 
                            @click="showProgramInModal(channel, program)" :title="program.title">
                            
                            <div class="badge-live" v-if="isProgramLive(program)"><i class="bi bi-circle-fill"></i></div>
                            <!--
                            <button class="favorite-btn float-end" :class="{'active' : isFavoriteProgram(channel, program)}" @click="toggleFavoriteProgram(channel, program)" title="Aggiungi programma ai preferiti">
                                <i class="bi bi-star"></i>
                            </button>
                            -->
                            
                            <div class="program-title">{{program.title}}</div>
                            <div class="program-time">
                                <span>{{formatTime(program.start)}}</span> - <span>{{formatTime(program.stop)}}</span> - <span>{{ getDuration(program)}}</span>
                            </div>
                            <span class="program-genre">{{program.category}}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="epgMobile" class="" v-if="isMobile == true">
                <div class="horizontal-scroll box-shadow">
                    <div class="epg-column " v-for="channel in getEpgChannels()" :key="channel.id">
                        <div class="epg-channel" @click="showChannelSchedule(channel)">
                            <button class="favorite-btn float-end" 
                                    :class="{'active' : isFavoriteChannel(channel)}" 
                                    @click="toggleFavoriteChannel(channel)" 
                                    title="Aggiungi canale ai preferiti">
                                        <i class="bi bi-star"></i>
                            </button>
                            <img class="logo-image" :src="channel.logo ?? 'invalid-url'" :alt="channel.name" :title="channel.name" @error="handleImageError" />
                            <!--<div class="logo-text">{{channel.name}}</div>-->
                        </div>
                        <ul class="epg-program-list list-group list-group-flush">
                            <li class="list-group-item" v-for="program in getEpgPrograms(channel)" :key="program.id">
                                <div class="epg-program" :class="{'active' : isProgramLive(program) || isFavoriteProgram(channel, program)}" 
                                    @click="showProgramInModal(channel, program)">

                                    

                                    <div class="badge-live" v-if="isProgramLive(program)"><i class="bi bi-circle-fill"></i></div>
                                    <button class="favorite-btn float-end" :class="{'active' : isFavoriteProgram(channel, program)}" @click="toggleFavoriteProgram(channel,program)" title="Aggiungi programma ai preferiti">
                                        <i class="bi bi-star"></i>
                                    </button>
                                    
                                    <div class="program-time">{{formatTime(program.start)}} - {{formatTime(program.stop)}}</div>
                                    <div class="program-image"><img class="logo-image" :src="program.image ?? 'invalid-url'" :alt="program.title" :title="program.title" @error="handleImageError"/></div>
                                    <div class="program-title">{{program.title}}</div>
                                    <div class="program-genre">
                                        <span>{{program.category}}</span>
                                        <!--<span class="badge bg-danger" v-if="isProgramLive(program)"><i class="bi bi-play-circle-fill"></i> IN ONDA</span>-->
                                    </div>
                                    
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        

        <!-- Films Section -->
         <div id="moviesSection" class="section" v-if="currentSection == 'movies'">
            <div class="float-end form-check">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input" v-model="hideAiredMovies"/> Prossimi
                </label>
            </div>
            <h2 class="mb-4"><i class="bi bi-film"></i> Films ({{allMovies.length}})</h2>
            <div id="moviesGrid" class="movies-grid">
                <div class="movie-card" v-for="movie in allMovies">
                    <div class="text-center mb-3">
                        <div class="d-flex justify-content-center align-items-center gap-2 mt-2">
                            <img :src="movie.channelLogo" :alt="movie.channelName" :title="movie.channelName">
                            <h4 class="mx-3">{{movie.channelName}}</h4>
                            <button class="favorite-btn float-end" 
                            :class="{'active' : isFavoriteChannel(movie.channelName)}" 
                            @click="toggleFavoriteChannel(movie.channelName)" 
                            title="Aggiungi canale ai preferiti">
                                <i class="bi bi-star"></i>
                            </button>
                        </div>
                    </div>
                    <div class="program-card">
                        <div class="badge-live" v-if="isProgramLive(movie)"><i class="bi bi-circle-fill"></i></div>
                        <img :src="movie.image" :alt="movie.title" class="program-image">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h3 class="program-title">{{movie.title}}</h3>
                            <button class="favorite-btn float-end" 
                            :class="{'active' : isFavoriteProgram(movie.channelName, movie.title)}" 
                            @click="toggleFavoriteProgram(movie.channelName, movie.title)" title="Aggiungi programma ai preferiti">
                                <i class="bi bi-star"></i>
                            </button>
                        </div>
                        <div class="program-time">
                            <span><i class="bi bi-clock"></i> {{movie.startTime}} - {{movie.stopTime}} • {{movie.duration}}</span>
                            <span>
                            <a :href="movie.tmdbLink" target="_blank" class="badge bg-success"><i class="bi bi-box-arrow-up-right"></i> TMDB</a>
                            </span>
                        </div>
                        <p class="mt-3 program-description">{{movie.description}}</p>

                        <div class="border-top mt-2" >
                                <a class="btn btn-primary mt-3 w-100" :href="movie.channelLink" target="_blank" >
                                    <i class="bi bi-play-fill"></i> Guarda Online
                                </a>
                        </div>
                    </div>
                </div>
            </div>
         </div>

        <!-- Lista Canali Section -->
        <div id="channelsSection" class="section" v-if="currentSection == 'channels'">
            <h2 class="mb-4"><i class="bi bi-grid-3x3"></i> Tutti i Canali</h2>
            <div id="channelsGrid" class="channels-grid">
                <div class="channel-grid-item" v-for="channel in channels" @click="showChannelSchedule(channel)">
                    <img :src="channel.logo ?? 'invalid-url'" :alt="channel.name" :title="channel.name" class="channel-logo" @error="handleImageError">
                    <div class="channel-name">{{channel.name}}</div>
                </div>
            </div>
        </div>

        <!-- Schermata Ricerca -->
         <div id="searchSection" class="section" v-show="currentSection == 'search'">
            <h2 class="mb-4"><i class="bi bi-search"></i> Cerca Canali e Programmi</h2>
            <input type="search" class="form-control search-input mb-4" autofocus id="searchInput" placeholder="Cerca canale o programma..." v-model="searchQuery" >
            <div v-if="searchQuery.length < 2">
                <small>Inserisci almento 2 caratteri</small>
            </div>
            <div v-if="searchQuery.length > 2 & searchResults.length == 0">
                <small>Nessun risultato trovato..</small>
            </div>
            <div id="searchResults" class="search-results-list" v-show="searchResults.length > 0">
                <div v-for="item in searchResults" class="search-result" @click="handleSearchResultClick(item)">
                    <div class="d-flex align-items-center">
                        <img :src="item.image ?? 'invalid-url'" class="search-result-image" @error="handleImageError">
                        <div class="flex-grow-1">
                            <div class="fw-bold">{{item.title}}</div>
                            <small class="text-light">
                                <span v-if="item.channel" class="me-3 fw-bold"><i class="bi bi-tv"></i> {{item.channel.name}}</span>
                                <span v-if="item.program" class="me-3"><i class="bi bi-clock"></i> {{ formatTime(item.program.start)}}</span>
                                <span v-if="item.program" class="program-genre me-3">{{item.program.category}}</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
         </div>

    </div>

    <!-- Bottom Sheet Backdrop -->
    <div class="bottom-sheet-backdrop" :class="{'show' : showBottomSheet}" v-if="showBottomSheet" id="bottomSheetBackdrop" @click="showBottomSheet = false"></div>

    <!-- Bottom Sheet -->
    <div class="bottom-sheet" :class="{'show' : showBottomSheet}" id="bottomSheet" v-if="showBottomSheet"
        ref="modal"
            @touchstart="startDrag"
            @touchmove="onDrag"
            @touchend="endDrag">
        
        <div class="bottom-sheet-handle"></div>
        <div class="p-4" id="bottomSheetContent">
            <div class="text-center mb-3">
                <div class="d-flex justify-content-center align-items-center gap-2 mt-2">
                    <img :src="selectedChannel.logo ?? 'invalid-url'" :alt="selectedChannel.name" :title="selectedChannel.name" @error="handleImageError">
                    <h4 class="mx-3">{{selectedChannel.name}}</h4>
                    <button class="favorite-btn float-end" :class="{'active' : isFavoriteChannel(selectedChannel)}" @click="toggleFavoriteChannel(selectedChannel)" title="Aggiungi canale ai preferiti">
                        <i class="bi bi-star"></i>
                    </button>
                </div>
            </div>
            <div class="program-card" v-if="selectedProgram">
                <img :src="selectedProgram.image ?? 'invalid-url'" class="program-image" @error="handleImageError">
                <div class="d-flex justify-content-between align-items-start mb-2">
                        <h3 class="program-title">{{selectedProgram.title}}</h3>
                        <button class="favorite-btn float-end" :class="{'active' : isFavoriteProgram(selectedChannel, selectedProgram)}" 
                        @click="toggleFavoriteProgram(selectedChannel, selectedProgram)" title="Aggiungi programma ai preferiti">
                            <i class="bi bi-star"></i>
                        </button>
                </div>
                
                <div class="program-time">
                    <i class="bi bi-clock"></i> {{formatTime(selectedProgram.start)}} • {{getDuration(selectedProgram)}}
                </div>
                <span class="program-genre">{{selectedProgram.category}}</span>
                <!--<span class="badge bg-danger" v-if="isProgramLive(selectedProgram)" >IN ONDA</span>-->
                <div class="badge-live" v-if="isProgramLive(selectedProgram)"><i class="bi bi-circle-fill"></i></div>

                <p class="mt-3">{{selectedProgram.description}}</p>
                <div class="mt-3" v-if="isProgramLive(selectedProgram)">
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" :style="{ width: getProgress(selectedProgram) + '%' }"></div>
                    </div>
                    <small class="text-muted">{{getProgress(selectedProgram)}} completato</small>
                    <div class="border-top mt-2">
                        <a class="btn btn-primary mt-3 w-100" :href="selectedChannel.externalUrl" target="_blank">
                            <i class="bi bi-play-fill"></i> Guarda Online
                        </a>
                    </div>
                </div>
                <div v-else>
                    <!-- aggiungi a calendario -->
                </div>
                
            </div>
        
    </div>
    </div>

    <!-- Channel Schedule Modal -->
    <div class="modal fade" :class="{'show' : showScheduleModal}" id="scheduleModal" tabindex="-1" v-if="showScheduleModal == true && selectedChannel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-between">
                    <img :src="selectedChannel.logo ?? 'invalid-url'" :alt="selectedChannel.name" @error="handleImageError">
                    <h5 class="modal-title me-5" id="scheduleChannelName">{{selectedChannel.name}}</h5>

                    <button class="favorite-btn" :class="{'active' : isFavoriteChannel(selectedChannel)}" @click="toggleFavoriteChannel(selectedChannel)" title="Aggiungi canale ai preferiti">
                        <i class="bi bi-star"></i>
                    </button>

                    <button type="button" class="btn-close btn-close-white text-white" @click="showScheduleModal = false"></button>
                </div>
                <div class="modal-body" id="scheduleContent" >
                    <div class="program-card" :class="{ 'border-primary': isProgramLive(program) }"
                        v-for="program in selectedChannel.programs" :key="program.id"
                        @click="showProgramInModal(selectedChannel, program);showScheduleModal=false;">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                                
                                <h5 class="program-title" >{{program.title}}</h5>
                                
                                <button class="favorite-btn" :class="{'active' : isFavoriteProgram(selectedChannel, program)}" 
                                @click.stop="toggleFavoriteProgram(selectedChannel, program)" title="Aggiungi programma ai preferiti">
                                    <i class="bi bi-star"></i>
                                </button>
                        </div>
                        <div class="program-time">
                                    <i class="bi bi-clock"></i> {{ formatTime(program.start)}} • {{getDuration(program)}}
                                </div>
                        <span class="program-genre">{{program.category}}</span>
                        <!--<span class="badge bg-danger" v-if="isProgramLive(program)" >IN ONDA</span>-->
                        <div class="badge-live" v-if="isProgramLive(program)"><i class="bi bi-circle-fill"></i></div>
                        <p class="mt-2 mb-0 small">{{program.description}}</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-primary mt-3" :href="selectedChannel.externalUrl" target="_blank">
                            <i class="bi bi-play-fill"></i> Guarda Online
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Banner -->
    <div class="cookie-banner" id="cookieBanner" v-if="showCookieBanner==true" >
        <div class="cookie-banner-content">
            <div class="cookie-banner-text">
                <h5><i class="bi bi-shield-check"></i> Privacy & Cookie</h5>
                <p>
                    Questo sito <strong>non utilizza cookie di tracciamento</strong> e <strong>non memorizza informazioni personali</strong>. 
                    Utilizziamo solo la memoria del browser per salvare le tue preferenze come i canali preferiti.
                </p>
            </div>
            <div class="cookie-banner-actions">
                <!-- Versione semplice (attuale) -->
                <button class="btn btn-simple-ok" @click="acceptCookies(false)">
                    <i class="bi bi-check-circle"></i> Ho capito
                </button>
                
                <!-- Versione futura con profiliazione (commentata, pronta all'uso) -->
                <!--
                <button class="btn btn-accept-all" onclick="app.acceptCookies(true)">
                    <i class="bi bi-check-circle"></i> Accetta Tutto
                </button>
                <button class="btn btn-reject-optional" onclick="app.acceptCookies(false)">
                    <i class="bi bi-x-circle"></i> Rifiuta Opzionali
                </button>
                -->
            </div>
        </div>
    </div>
   </div>

   <script src="js/scripts.js"></script>

</body>
</html>
